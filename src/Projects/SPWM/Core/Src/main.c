/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2025 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"
#include "tim.h"
#include "gpio.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */

/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */

/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */
uint16_t spwmcnt=0;//数组计数值：0~399；
float M=0.8;//调制比M：0~1
double spwm_group[400]={0.0,62.8292692472827,125.64303631251317,188.42580283857066,251.1620781172535,313.83638291137976,376.4332532740573,438.93724436418114,501.33293425721706,563.6049277503307,625.7378601609234,687.7164011176382,749.5252583428985,811.14918142605,872.5729655861703,933.7814554236217,994.7595486594191,1055.4921998614916,1115.9644241569172,1176.161300929216,1236.0679774997895,1295.6696727925976,1354.9516809811657,1413.8993751170285,1472.4982107387118,1530.7337294603594,1588.5915625391224,1646.0574344204354,1703.1171662602908,1759.7566794236604,1815.9619989581872,1871.7192570422935,1927.0146964068613,1981.8346737296304,2036.1656630014852,2089.994258863795,2143.3071799159866,2196.0912719925273,2248.3335114085226,2300.0210081731143,2351.1410091698926,2401.680901303536,2451.628214611906,2500.9706253428208,2549.695958994759,2597.792193320735,2645.247461294607,2692.050054039093,2738.188423714755,2783.651186369257,2828.42712474619,2872.5051910527554,2915.874509685646,2958.5243799144387,3000.4442785218384,3041.6238624001244,3082.0529711031572,3121.721629353319,3160.6200495027615,3198.7386339483623,3236.06797749979,3272.598869700094,3308.3222970982474,3343.229445473081,3377.3117020080604,3410.5606574163685,3442.9681080157748,3474.526057752765,3505.226720175455,3535.062520354774,3564.026096753471,3592.1103030424624,3619.3082098640784,3645.6131065417812,3671.0185027359244,3695.518130045147,3719.105943553006,3741.776123319469,3763.5230758169023,3784.341435310181,3804.226065180614,3823.1720591933204,3841.174742707772,3858.2296738311925,3874.3326445145244,3889.4796815907066,3903.6670477549897,3916.891242487063,3929.149002914755,3940.437304619096,3950.753362380551,3960.09463086623,3968.4588052579115,3975.843821820719,3982.24785841232,3987.669334932512,3992.106913713086,3995.55949984788,3998.0262414629265,3999.5065299266425,4000.0,3999.5065299266425,3998.0262414629265,3995.55949984788,3992.106913713086,3987.669334932512,3982.24785841232,3975.843821820719,3968.458805257911,3960.09463086623,3950.7533623805507,3940.4373046190954,3929.1490029147544,3916.891242487063,3903.6670477549897,3889.479681590706,3874.3326445145244,3858.2296738311925,3841.174742707772,3823.1720591933204,3804.226065180614,3784.341435310181,3763.523075816902,3741.776123319469,3719.105943553006,3695.518130045147,3671.0185027359244,3645.613106541781,3619.308209864078,3592.1103030424624,3564.0260967534714,3535.062520354773,3505.226720175454,3474.5260577527647,3442.9681080157748,3410.560657416369,3377.31170200806,3343.2294454730804,
	3308.322297098247,3272.5988697000935,3236.06797749979,3198.7386339483614,3160.620049502761,3121.721629353319,3082.0529711031572,3041.623862400124,3000.4442785218375,2958.524379914438,2915.874509685646,2872.5051910527554,2828.42712474619,2783.6511863692563,2738.188423714754,2692.050054039093,2645.247461294607,2597.792193320735,2549.6959589947583,2500.9706253428203,2451.6282146119056,2401.680901303536,2351.141009169893,2300.0210081731134,2248.333511408522,2196.091271992527,2143.3071799159866,2089.994258863794,2036.1656630014843,1981.8346737296295,1927.0146964068608,1871.7192570422935,1815.9619989581859,1759.7566794236598,1703.1171662602899,1646.057434420435,1588.5915625391224,1530.7337294603578,1472.4982107387111,1413.8993751170278,1354.9516809811653,1295.6696727925978,1236.0679774997884,1176.1613009292148,1115.9644241569165,1055.4921998614911,994.7595486594192,933.7814554236204,872.5729655861693,811.1491814260493,749.5252583428983,687.7164011176383,625.7378601609222,563.6049277503297,501.3329342572164,438.93724436418086,376.4332532740574,313.8363829113785,251.16207811725255,188.42580283857006,125.64303631251295,62.82926924728284,-1.2864981197413093e-12,-62.829269247283634,-125.64303631251376,-188.42580283857086,-251.16207811725337,-313.83638291138107,-376.4332532740582,-438.93724436418165,-501.3329342572171,-563.6049277503305,-625.7378601609247,-687.7164011176391,-749.5252583428991,-811.1491814260501,-872.5729655861701,-933.7814554236229,-994.75954865942,-1055.492199861492,-1115.9644241569172,-1176.1613009292155,-1236.067977499791,-1295.6696727925985,-1354.951680981166,-1413.8993751170285,-1472.4982107387132,-1530.7337294603603,-1588.591562539123,-1646.0574344204356,-1703.1171662602906,-1759.7566794236618,-1815.9619989581884,-1871.7192570422942,-1927.0146964068615,-1981.8346737296301,-2036.1656630014866,-2089.9942588637964,-2143.307179915987,-2196.0912719925273,-2248.3335114085226,-2300.0210081731157,-2351.1410091698936,-2401.6809013035368,-2451.6282146119065,-2500.9706253428208,-2549.69595899476,-2597.7921933207354,-2645.247461294608,-2692.0500540390935,-2738.188423714755,-2783.651186369258,-2828.4271247461907,-2872.505191052756,-2915.874509685646,-2958.5243799144387,-3000.4442785218394,-3041.623862400125,-3082.0529711031572,-3121.7216293533193,-3160.6200495027615,-3198.738633948362,-3236.0679774997893,-3272.598869700095,-3308.322297098249,-3343.229445473082,-3377.3117020080613,-3410.5606574163694,-3442.968108015775,-3474.526057752765,-3505.2267201754544,-3535.0625203547734,-3564.026096753471,
	-3592.1103030424633,-3619.3082098640793,-3645.6131065417817,-3671.018502735925,-3695.5181300451472,-3719.105943553006,-3741.7761233194697,-3763.523075816902,-3784.341435310181,-3804.226065180614,-3823.1720591933213,-3841.1747427077726,-3858.229673831193,-3874.332644514525,-3889.4796815907066,-3903.6670477549897,-3916.891242487063,-3929.149002914755,-3940.4373046190954,-3950.7533623805507,-3960.0946308662305,-3968.4588052579115,-3975.843821820719,-3982.24785841232,-3987.669334932512,-3992.106913713086,-3995.55949984788,-3998.0262414629265,-3999.5065299266425,-4000.0,-3999.5065299266425,-3998.026241462926,-3995.5594998478796,-3992.106913713086,-3987.669334932512,-3982.24785841232,-3975.843821820719,-3968.4588052579115,-3960.09463086623,-3950.753362380551,-3940.4373046190954,-3929.1490029147544,-3916.8912424870628,-3903.667047754989,-3889.479681590706,-3874.3326445145244,-3858.2296738311925,-3841.174742707772,-3823.1720591933204,-3804.2260651806146,-3784.3414353101803,-3763.5230758169014,-3741.7761233194688,-3719.105943553005,-3695.5181300451463,-3671.018502735924,-3645.613106541781,-3619.3082098640784,-3592.1103030424624,-3564.0260967534705,-3535.0625203547725,-3505.2267201754535,-3474.526057752764,-3442.968108015774,-3410.5606574163685,-3377.31170200806,-3343.2294454730804,-3308.3222970982474,-3272.598869700094,-3236.067977499788,-3198.7386339483605,-3160.62004950276,-3121.721629353318,-3082.0529711031563,-3041.6238624001235,-3000.444278521838,-2958.5243799144387,-2915.874509685646,-2872.505191052756,-2828.427124746188,-2783.6511863692554,-2738.1884237147533,-2692.0500540390917,-2645.2474612946066,-2597.7921933207335,-2549.6959589947587,-2500.9706253428208,-2451.628214611906,-2401.6809013035363,-2351.1410091698904,-2300.0210081731125,-2248.3335114085207,-2196.0912719925254,-2143.307179915985,-2089.9942588637946,-2036.1656630014847,-1981.83467372963,-1927.0146964068613,-1871.719257042294,-1815.9619989581847,-1759.7566794236586,-1703.117166260289,-1646.0574344204338,-1588.5915625391215,-1530.7337294603583,-1472.4982107387114,-1413.8993751170283,-1354.9516809811657,-1295.6696727925982,-1236.067977499787,-1176.1613009292137,-1115.9644241569151,-1055.49219986149,-994.759548659418,-933.7814554236207,-872.5729655861697,-811.1491814260498,-749.5252583428987,-687.7164011176353,-625.737860160921,-563.6049277503284,-501.33293425721513,-438.9372443641796,-376.43325327405614,-313.836382911379,-251.16207811725306,-188.42580283857055,-125.64303631251344,-62.829269247279775,};
 void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)  //中断回调函数 20k
{
	if(htim==&htim6)
	{
	TIM1->CCR1 = 4000.f + M*spwm_group[spwmcnt] ;//2khz的频率改变400次，2000/400=5hz的正弦波；
	spwmcnt++;
  if(spwmcnt==400)spwmcnt=0;	
  }
}
/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/

/* USER CODE BEGIN PV */

/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
/* USER CODE BEGIN PFP */

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{

  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_TIM1_Init();
  MX_TIM6_Init();
  /* USER CODE BEGIN 2 */
	HAL_TIM_Base_Start_IT(&htim6);//开启定时器6中断
	HAL_TIM_PWM_Start (&htim1,TIM_CHANNEL_1);//开启两路pwm波
	HAL_TIMEx_PWMN_Start (&htim1,TIM_CHANNEL_1);
  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  /** Configure the main internal regulator output voltage
  */
  __HAL_RCC_PWR_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);

  /** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)
  {
    Error_Handler();
  }
}

/* USER CODE BEGIN 4 */

/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */
